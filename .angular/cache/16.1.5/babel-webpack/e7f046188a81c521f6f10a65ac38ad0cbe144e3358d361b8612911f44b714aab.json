{"ast":null,"code":"import * as Stomp from 'stompjs';\nimport * as SockJS from 'sockjs-client';\nexport class WebSocketAPI {\n  constructor(appComponent) {\n    this.webSocketEndPoint = 'http://localhost:8080/ws';\n    this.topic = \"/topic/greetings\";\n    this.appComponent = appComponent;\n  }\n  _connect() {\n    console.log(\"Initialize WebSocket Connection\");\n    let ws = new SockJS(this.webSocketEndPoint);\n    this.stompClient = Stomp.over(ws);\n    const _this = this;\n    _this.stompClient.connect({}, function (frame) {\n      _this.stompClient.subscribe(_this.topic, function (sdkEvent) {\n        _this.onMessageReceived(sdkEvent);\n      });\n      //_this.stompClient.reconnect_delay = 2000;\n    }, this.errorCallBack);\n  }\n  _disconnect() {\n    if (this.stompClient !== null) {\n      this.stompClient.disconnect();\n    }\n    console.log(\"Disconnected\");\n  }\n  // on error, schedule a reconnection attempt\n  errorCallBack(error) {\n    console.log(\"errorCallBack -> \" + error);\n    setTimeout(() => {\n      this._connect();\n    }, 5000);\n  }\n  /**\n   * Send message to sever via web socket\n   * @param {*} message\n   */\n  _send(message) {\n    console.log(\"calling logout api via web socket\");\n    this.stompClient.send(\"/app/hello\", {}, JSON.stringify(message));\n  }\n  /* onMessageReceived(message: string) {\n       console.log(\"Message Recieved from Server :: \" + message);\n       //this.appComponent.handleMessage(JSON.stringify(message.body));\n             const parsedMessage = JSON.parse(message);\n           this.appComponent.handleMessage(parsedMessage.body);\n         \n         \n   }*/\n  onMessageReceived(message) {\n    console.log(\"Message Received from Server :: \" + message);\n    // Check if the message is an object with a 'data' property\n    if (typeof message === \"object\" && message.hasOwnProperty(\"data\")) {\n      const messageData = message.data;\n      const messagePrefix = \"MESSAGE co\";\n      if (messageData.startsWith(messagePrefix)) {\n        // Remove the prefix from the message\n        const jsonPart = messageData.substring(messagePrefix.length);\n        // Parse the JSON part of the message\n        try {\n          const parsedMessage = JSON.parse(jsonPart);\n          // Now you can access properties of the parsed message and handle it accordingly\n          console.log(\"Parsed Message:\", parsedMessage);\n        } catch (error) {\n          console.error(\"Error parsing message:\", error);\n        }\n      } else {\n        console.error(\"Unexpected message format:\", messageData);\n      }\n    } else {\n      console.error(\"Invalid message format:\", message);\n    }\n  }\n}","map":{"version":3,"names":["Stomp","SockJS","WebSocketAPI","constructor","appComponent","webSocketEndPoint","topic","_connect","console","log","ws","stompClient","over","_this","connect","frame","subscribe","sdkEvent","onMessageReceived","errorCallBack","_disconnect","disconnect","error","setTimeout","_send","message","send","JSON","stringify","hasOwnProperty","messageData","data","messagePrefix","startsWith","jsonPart","substring","length","parsedMessage","parse"],"sources":["C:\\Users\\hp\\coChat\\src\\app\\services\\WebSocketAPI.ts"],"sourcesContent":["import * as Stomp from 'stompjs';\r\nimport * as SockJS from 'sockjs-client';\r\nimport { AppComponent } from '../app.component';\r\n\r\nexport class WebSocketAPI {\r\n    webSocketEndPoint: string = 'http://localhost:8080/ws';\r\n    topic: string = \"/topic/greetings\";\r\n    stompClient: any;\r\n    appComponent: AppComponent;\r\n    constructor(appComponent: AppComponent){\r\n        this.appComponent = appComponent;\r\n    }\r\n    _connect() {\r\n        console.log(\"Initialize WebSocket Connection\");\r\n        let ws = new SockJS(this.webSocketEndPoint);\r\n        this.stompClient = Stomp.over(ws);\r\n        const _this = this;\r\n        _this.stompClient.connect({}, function (frame: any) {\r\n            _this.stompClient.subscribe(_this.topic, function (sdkEvent: any) {\r\n                _this.onMessageReceived(sdkEvent);\r\n            });\r\n            //_this.stompClient.reconnect_delay = 2000;\r\n        }, this.errorCallBack);\r\n    };\r\n\r\n    _disconnect() {\r\n        if (this.stompClient !== null) {\r\n            this.stompClient.disconnect();\r\n        }\r\n        console.log(\"Disconnected\");\r\n    }\r\n\r\n    // on error, schedule a reconnection attempt\r\n    errorCallBack(error: string) {\r\n        console.log(\"errorCallBack -> \" + error)\r\n        setTimeout(() => {\r\n            this._connect();\r\n        }, 5000);\r\n    }\r\n\r\n /**\r\n  * Send message to sever via web socket\r\n  * @param {*} message \r\n  */\r\n    _send(message: string) {\r\n        console.log(\"calling logout api via web socket\");\r\n        this.stompClient.send(\"/app/hello\", {}, JSON.stringify(message));\r\n    }\r\n\r\n   /* onMessageReceived(message: string) {\r\n        console.log(\"Message Recieved from Server :: \" + message);\r\n        //this.appComponent.handleMessage(JSON.stringify(message.body));\r\n\r\n            const parsedMessage = JSON.parse(message);\r\n            this.appComponent.handleMessage(parsedMessage.body);\r\n          \r\n          \r\n    }*/\r\n    onMessageReceived(message: any) {\r\n        console.log(\"Message Received from Server :: \" + message);\r\n      \r\n        // Check if the message is an object with a 'data' property\r\n        if (typeof message === \"object\" && message.hasOwnProperty(\"data\")) {\r\n          const messageData = message.data;\r\n      \r\n          const messagePrefix = \"MESSAGE co\";\r\n          if (messageData.startsWith(messagePrefix)) {\r\n            // Remove the prefix from the message\r\n            const jsonPart = messageData.substring(messagePrefix.length);\r\n      \r\n            // Parse the JSON part of the message\r\n            try {\r\n              const parsedMessage = JSON.parse(jsonPart);\r\n              // Now you can access properties of the parsed message and handle it accordingly\r\n              console.log(\"Parsed Message:\", parsedMessage);\r\n            } catch (error) {\r\n              console.error(\"Error parsing message:\", error);\r\n            }\r\n          } else {\r\n            console.error(\"Unexpected message format:\", messageData);\r\n          }\r\n        } else {\r\n          console.error(\"Invalid message format:\", message);\r\n        }\r\n      }\r\n      \r\n      \r\n      \r\n      \r\n}"],"mappings":"AAAA,OAAO,KAAKA,KAAK,MAAM,SAAS;AAChC,OAAO,KAAKC,MAAM,MAAM,eAAe;AAGvC,OAAM,MAAOC,YAAY;EAKrBC,YAAYC,YAA0B;IAJtC,KAAAC,iBAAiB,GAAW,0BAA0B;IACtD,KAAAC,KAAK,GAAW,kBAAkB;IAI9B,IAAI,CAACF,YAAY,GAAGA,YAAY;EACpC;EACAG,QAAQA,CAAA;IACJC,OAAO,CAACC,GAAG,CAAC,iCAAiC,CAAC;IAC9C,IAAIC,EAAE,GAAG,IAAIT,MAAM,CAAC,IAAI,CAACI,iBAAiB,CAAC;IAC3C,IAAI,CAACM,WAAW,GAAGX,KAAK,CAACY,IAAI,CAACF,EAAE,CAAC;IACjC,MAAMG,KAAK,GAAG,IAAI;IAClBA,KAAK,CAACF,WAAW,CAACG,OAAO,CAAC,EAAE,EAAE,UAAUC,KAAU;MAC9CF,KAAK,CAACF,WAAW,CAACK,SAAS,CAACH,KAAK,CAACP,KAAK,EAAE,UAAUW,QAAa;QAC5DJ,KAAK,CAACK,iBAAiB,CAACD,QAAQ,CAAC;MACrC,CAAC,CAAC;MACF;IACJ,CAAC,EAAE,IAAI,CAACE,aAAa,CAAC;EAC1B;EAEAC,WAAWA,CAAA;IACP,IAAI,IAAI,CAACT,WAAW,KAAK,IAAI,EAAE;MAC3B,IAAI,CAACA,WAAW,CAACU,UAAU,EAAE;;IAEjCb,OAAO,CAACC,GAAG,CAAC,cAAc,CAAC;EAC/B;EAEA;EACAU,aAAaA,CAACG,KAAa;IACvBd,OAAO,CAACC,GAAG,CAAC,mBAAmB,GAAGa,KAAK,CAAC;IACxCC,UAAU,CAAC,MAAK;MACZ,IAAI,CAAChB,QAAQ,EAAE;IACnB,CAAC,EAAE,IAAI,CAAC;EACZ;EAEH;;;;EAIGiB,KAAKA,CAACC,OAAe;IACjBjB,OAAO,CAACC,GAAG,CAAC,mCAAmC,CAAC;IAChD,IAAI,CAACE,WAAW,CAACe,IAAI,CAAC,YAAY,EAAE,EAAE,EAAEC,IAAI,CAACC,SAAS,CAACH,OAAO,CAAC,CAAC;EACpE;EAED;;;;;;;;EASCP,iBAAiBA,CAACO,OAAY;IAC1BjB,OAAO,CAACC,GAAG,CAAC,kCAAkC,GAAGgB,OAAO,CAAC;IAEzD;IACA,IAAI,OAAOA,OAAO,KAAK,QAAQ,IAAIA,OAAO,CAACI,cAAc,CAAC,MAAM,CAAC,EAAE;MACjE,MAAMC,WAAW,GAAGL,OAAO,CAACM,IAAI;MAEhC,MAAMC,aAAa,GAAG,YAAY;MAClC,IAAIF,WAAW,CAACG,UAAU,CAACD,aAAa,CAAC,EAAE;QACzC;QACA,MAAME,QAAQ,GAAGJ,WAAW,CAACK,SAAS,CAACH,aAAa,CAACI,MAAM,CAAC;QAE5D;QACA,IAAI;UACF,MAAMC,aAAa,GAAGV,IAAI,CAACW,KAAK,CAACJ,QAAQ,CAAC;UAC1C;UACA1B,OAAO,CAACC,GAAG,CAAC,iBAAiB,EAAE4B,aAAa,CAAC;SAC9C,CAAC,OAAOf,KAAK,EAAE;UACdd,OAAO,CAACc,KAAK,CAAC,wBAAwB,EAAEA,KAAK,CAAC;;OAEjD,MAAM;QACLd,OAAO,CAACc,KAAK,CAAC,4BAA4B,EAAEQ,WAAW,CAAC;;KAE3D,MAAM;MACLtB,OAAO,CAACc,KAAK,CAAC,yBAAyB,EAAEG,OAAO,CAAC;;EAErD"},"metadata":{},"sourceType":"module","externalDependencies":[]}