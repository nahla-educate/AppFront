{"ast":null,"code":"import { Observable } from 'rxjs';\nimport { filter, first } from 'rxjs/operators';\nimport { UUID } from 'angular2-uuid';\n/**\n * An implementation of Remote Procedure Call (RPC) using messaging.\n *\n * Please see the [guide](/guide/rx-stomp/ng2-stompjs/remote-procedure-call.html) for details.\n *\n * Part of `@stomp/rx-stomp`\n */\nexport class RxStompRPC {\n  /**\n   * Create an instance, see the [guide](/guide/rx-stomp/ng2-stompjs/remote-procedure-call.html) for details.\n   */\n  constructor(rxStomp, stompRPCConfig) {\n    this.rxStomp = rxStomp;\n    this.stompRPCConfig = stompRPCConfig;\n    this._replyQueueName = '/temp-queue/rpc-replies';\n    this._setupReplyQueue = () => {\n      return this.rxStomp.unhandledMessage$;\n    };\n    this._customReplyQueue = false;\n    if (stompRPCConfig) {\n      if (stompRPCConfig.replyQueueName) {\n        this._replyQueueName = stompRPCConfig.replyQueueName;\n      }\n      if (stompRPCConfig.setupReplyQueue) {\n        this._customReplyQueue = true;\n        this._setupReplyQueue = stompRPCConfig.setupReplyQueue;\n      }\n    }\n  }\n  /**\n   * Make an RPC request.\n   * See the [guide](/guide/rx-stomp/ng2-stompjs/remote-procedure-call.html) for example.\n   *\n   * It is a simple wrapper around [RxStompRPC#stream]{@link RxStompRPC#stream}.\n   */\n  rpc(params) {\n    // We know there will be only one message in reply\n    return this.stream(params).pipe(first());\n  }\n  /**\n   * Make an RPC stream request. See the [guide](/guide/rx-stomp/ng2-stompjs/remote-procedure-call.html).\n   *\n   * Note: This call internally takes care of generating a correlation id,\n   * however, if `correlation-id` is passed via `headers`, that will be used instead.\n   */\n  stream(params) {\n    // defensively copy\n    const headers = Object.assign({}, params.headers || {});\n    if (!this._repliesObservable) {\n      const repliesObservable = this._setupReplyQueue(this._replyQueueName, this.rxStomp);\n      // In case of custom queue, ensure it remains subscribed\n      if (this._customReplyQueue) {\n        this._dummySubscription = repliesObservable.subscribe(() => {});\n      }\n      this._repliesObservable = repliesObservable;\n    }\n    return Observable.create(rpcObserver => {\n      let defaultMessagesSubscription;\n      const correlationId = headers['correlation-id'] || UUID.UUID();\n      defaultMessagesSubscription = this._repliesObservable.pipe(filter(message => {\n        return message.headers['correlation-id'] === correlationId;\n      })).subscribe(message => {\n        rpcObserver.next(message);\n      });\n      // send an RPC request\n      headers['reply-to'] = this._replyQueueName;\n      headers['correlation-id'] = correlationId;\n      this.rxStomp.publish(Object.assign(Object.assign({}, params), {\n        headers\n      }));\n      return () => {\n        // Cleanup\n        defaultMessagesSubscription.unsubscribe();\n      };\n    });\n  }\n}","map":{"version":3,"names":["Observable","filter","first","UUID","RxStompRPC","constructor","rxStomp","stompRPCConfig","_replyQueueName","_setupReplyQueue","unhandledMessage$","_customReplyQueue","replyQueueName","setupReplyQueue","rpc","params","stream","pipe","headers","Object","assign","_repliesObservable","repliesObservable","_dummySubscription","subscribe","create","rpcObserver","defaultMessagesSubscription","correlationId","message","next","publish","unsubscribe"],"sources":["C:/Users/hp/coChat/node_modules/@stomp/rx-stomp/esm6/rx-stomp-rpc.js"],"sourcesContent":["import { Observable } from 'rxjs';\nimport { filter, first } from 'rxjs/operators';\nimport { UUID } from 'angular2-uuid';\n/**\n * An implementation of Remote Procedure Call (RPC) using messaging.\n *\n * Please see the [guide](/guide/rx-stomp/ng2-stompjs/remote-procedure-call.html) for details.\n *\n * Part of `@stomp/rx-stomp`\n */\nexport class RxStompRPC {\n    /**\n     * Create an instance, see the [guide](/guide/rx-stomp/ng2-stompjs/remote-procedure-call.html) for details.\n     */\n    constructor(rxStomp, stompRPCConfig) {\n        this.rxStomp = rxStomp;\n        this.stompRPCConfig = stompRPCConfig;\n        this._replyQueueName = '/temp-queue/rpc-replies';\n        this._setupReplyQueue = () => {\n            return this.rxStomp.unhandledMessage$;\n        };\n        this._customReplyQueue = false;\n        if (stompRPCConfig) {\n            if (stompRPCConfig.replyQueueName) {\n                this._replyQueueName = stompRPCConfig.replyQueueName;\n            }\n            if (stompRPCConfig.setupReplyQueue) {\n                this._customReplyQueue = true;\n                this._setupReplyQueue = stompRPCConfig.setupReplyQueue;\n            }\n        }\n    }\n    /**\n     * Make an RPC request.\n     * See the [guide](/guide/rx-stomp/ng2-stompjs/remote-procedure-call.html) for example.\n     *\n     * It is a simple wrapper around [RxStompRPC#stream]{@link RxStompRPC#stream}.\n     */\n    rpc(params) {\n        // We know there will be only one message in reply\n        return this.stream(params).pipe(first());\n    }\n    /**\n     * Make an RPC stream request. See the [guide](/guide/rx-stomp/ng2-stompjs/remote-procedure-call.html).\n     *\n     * Note: This call internally takes care of generating a correlation id,\n     * however, if `correlation-id` is passed via `headers`, that will be used instead.\n     */\n    stream(params) {\n        // defensively copy\n        const headers = Object.assign({}, (params.headers || {}));\n        if (!this._repliesObservable) {\n            const repliesObservable = this._setupReplyQueue(this._replyQueueName, this.rxStomp);\n            // In case of custom queue, ensure it remains subscribed\n            if (this._customReplyQueue) {\n                this._dummySubscription = repliesObservable.subscribe(() => { });\n            }\n            this._repliesObservable = repliesObservable;\n        }\n        return Observable.create((rpcObserver) => {\n            let defaultMessagesSubscription;\n            const correlationId = headers['correlation-id'] || UUID.UUID();\n            defaultMessagesSubscription = this._repliesObservable\n                .pipe(filter((message) => {\n                return message.headers['correlation-id'] === correlationId;\n            }))\n                .subscribe((message) => {\n                rpcObserver.next(message);\n            });\n            // send an RPC request\n            headers['reply-to'] = this._replyQueueName;\n            headers['correlation-id'] = correlationId;\n            this.rxStomp.publish(Object.assign(Object.assign({}, params), { headers }));\n            return () => {\n                // Cleanup\n                defaultMessagesSubscription.unsubscribe();\n            };\n        });\n    }\n}\n"],"mappings":"AAAA,SAASA,UAAU,QAAQ,MAAM;AACjC,SAASC,MAAM,EAAEC,KAAK,QAAQ,gBAAgB;AAC9C,SAASC,IAAI,QAAQ,eAAe;AACpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMC,UAAU,CAAC;EACpB;AACJ;AACA;EACIC,WAAWA,CAACC,OAAO,EAAEC,cAAc,EAAE;IACjC,IAAI,CAACD,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACC,cAAc,GAAGA,cAAc;IACpC,IAAI,CAACC,eAAe,GAAG,yBAAyB;IAChD,IAAI,CAACC,gBAAgB,GAAG,MAAM;MAC1B,OAAO,IAAI,CAACH,OAAO,CAACI,iBAAiB;IACzC,CAAC;IACD,IAAI,CAACC,iBAAiB,GAAG,KAAK;IAC9B,IAAIJ,cAAc,EAAE;MAChB,IAAIA,cAAc,CAACK,cAAc,EAAE;QAC/B,IAAI,CAACJ,eAAe,GAAGD,cAAc,CAACK,cAAc;MACxD;MACA,IAAIL,cAAc,CAACM,eAAe,EAAE;QAChC,IAAI,CAACF,iBAAiB,GAAG,IAAI;QAC7B,IAAI,CAACF,gBAAgB,GAAGF,cAAc,CAACM,eAAe;MAC1D;IACJ;EACJ;EACA;AACJ;AACA;AACA;AACA;AACA;EACIC,GAAGA,CAACC,MAAM,EAAE;IACR;IACA,OAAO,IAAI,CAACC,MAAM,CAACD,MAAM,CAAC,CAACE,IAAI,CAACf,KAAK,CAAC,CAAC,CAAC;EAC5C;EACA;AACJ;AACA;AACA;AACA;AACA;EACIc,MAAMA,CAACD,MAAM,EAAE;IACX;IACA,MAAMG,OAAO,GAAGC,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAGL,MAAM,CAACG,OAAO,IAAI,CAAC,CAAE,CAAC;IACzD,IAAI,CAAC,IAAI,CAACG,kBAAkB,EAAE;MAC1B,MAAMC,iBAAiB,GAAG,IAAI,CAACb,gBAAgB,CAAC,IAAI,CAACD,eAAe,EAAE,IAAI,CAACF,OAAO,CAAC;MACnF;MACA,IAAI,IAAI,CAACK,iBAAiB,EAAE;QACxB,IAAI,CAACY,kBAAkB,GAAGD,iBAAiB,CAACE,SAAS,CAAC,MAAM,CAAE,CAAC,CAAC;MACpE;MACA,IAAI,CAACH,kBAAkB,GAAGC,iBAAiB;IAC/C;IACA,OAAOtB,UAAU,CAACyB,MAAM,CAAEC,WAAW,IAAK;MACtC,IAAIC,2BAA2B;MAC/B,MAAMC,aAAa,GAAGV,OAAO,CAAC,gBAAgB,CAAC,IAAIf,IAAI,CAACA,IAAI,CAAC,CAAC;MAC9DwB,2BAA2B,GAAG,IAAI,CAACN,kBAAkB,CAChDJ,IAAI,CAAChB,MAAM,CAAE4B,OAAO,IAAK;QAC1B,OAAOA,OAAO,CAACX,OAAO,CAAC,gBAAgB,CAAC,KAAKU,aAAa;MAC9D,CAAC,CAAC,CAAC,CACEJ,SAAS,CAAEK,OAAO,IAAK;QACxBH,WAAW,CAACI,IAAI,CAACD,OAAO,CAAC;MAC7B,CAAC,CAAC;MACF;MACAX,OAAO,CAAC,UAAU,CAAC,GAAG,IAAI,CAACV,eAAe;MAC1CU,OAAO,CAAC,gBAAgB,CAAC,GAAGU,aAAa;MACzC,IAAI,CAACtB,OAAO,CAACyB,OAAO,CAACZ,MAAM,CAACC,MAAM,CAACD,MAAM,CAACC,MAAM,CAAC,CAAC,CAAC,EAAEL,MAAM,CAAC,EAAE;QAAEG;MAAQ,CAAC,CAAC,CAAC;MAC3E,OAAO,MAAM;QACT;QACAS,2BAA2B,CAACK,WAAW,CAAC,CAAC;MAC7C,CAAC;IACL,CAAC,CAAC;EACN;AACJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}